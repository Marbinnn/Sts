<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>STS Trivia</title>
  <style>
    :root{
      --bg:#0b0b0f;
      --line:#2b2b3a;
      --text:#f5f5ff;
      --muted:#b9b9d6;
      --good:#4ade80;
      --bad:#fb7185;
      --accent:#7c3aed;
      --accent2:#22c55e;
      --warn:#fbbf24;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --r:22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
      --sys: -apple-system, BlinkMacSystemFont, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sys);
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(124,58,237,.22), transparent 55%),
        radial-gradient(900px 700px at 80% 0%, rgba(34,197,94,.14), transparent 60%),
        radial-gradient(1200px 900px at 40% 100%, rgba(251,191,36,.10), transparent 60%),
        var(--bg);

      display:flex;
      justify-content:center;
      align-items:flex-start; /* mobile safe */
      padding: 16px;
      padding-top: calc(20px + env(safe-area-inset-top));
      padding-bottom: env(safe-area-inset-bottom);
    }

    .app{
      width:min(720px, 100%);
      margin:auto;
    }

    .card{
      background: rgba(20,20,27,.62);
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }

    .head{
      padding:14px 16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid var(--line);
      gap:12px;
    }
    .title{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
      letter-spacing:.2px;
      min-width:0;
    }
    .title .txt{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background:var(--accent);
      box-shadow:0 0 0 3px rgba(124,58,237,.22);
      flex:0 0 auto;
    }
    .pill{
      font-size:12px;
      color:var(--muted);
      border:1px solid var(--line);
      padding:6px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.03);
      font-family: var(--mono);
      white-space:nowrap;
    }

    .main{ padding:16px; }

    .qmeta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom:10px;
    }
    .chip{
      font-size:12px;
      color:var(--muted);
      border:1px solid var(--line);
      padding:6px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.03);
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .chip strong{ color:var(--text) }

    .progress{
      height:10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      overflow:hidden;
      flex:1;
      min-width:160px;
    }
    .bar{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, var(--accent), #60a5fa, var(--accent2));
      transition: width .25s ease;
    }

    /* 15s shrinking timer */
    .timerWrap{
      width:100%;
      height:9px;
      border-radius:999px;
      border:1px solid rgba(251,191,36,.45);
      background: rgba(255,255,255,.03);
      overflow:hidden;
      margin:10px 0 6px;
      display:none;
    }
    .timerBar{
      height:100%;
      width:100%;
      transform-origin:left;
      transform:scaleX(1);
      background: linear-gradient(90deg, rgba(251,191,36,.95), rgba(251,113,133,.95));
    }
    .timerHint{
      display:none;
      justify-content:space-between;
      font-size:12px;
      color:var(--muted);
      margin:0 0 10px;
      user-select:none;
    }
    .timerHint span{ font-family:var(--mono); opacity:.9; }

    .question{
      font-size:20px;
      font-weight:900;
      margin:8px 0 10px;
      line-height:1.25;
    }
    .sub{
      font-size:13px;
      color:var(--muted);
      margin:0 0 12px;
      line-height:1.5;
    }

    .choices{ display:grid; gap:10px; }

    .btn{
      display:flex;
      align-items:center;
      gap:12px;
      padding:14px;
      border-radius:16px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--text);
      cursor:pointer;
      transition: background .15s ease, transform .06s ease, border-color .15s ease;
      text-align:left;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.06); transform: translateY(-1px); }
    .btn:active{ transform: translateY(0px); }
    .btn[disabled]{ opacity:.70; cursor:not-allowed; transform:none; }

    .key{
      width:28px;height:28px;border-radius:10px;
      display:grid;place-items:center;
      font-size:12px;
      color:var(--muted);
      border:1px solid var(--line);
      background: rgba(0,0,0,.25);
      font-family: var(--mono);
      flex:0 0 auto;
    }
    .choiceText{ font-size:14px; line-height:1.35; }

    .btn.good{ border-color: rgba(74,222,128,.55); background: rgba(74,222,128,.12); }
    .btn.bad{ border-color: rgba(251,113,133,.55); background: rgba(251,113,133,.12); }

    .feedback{
      margin-top:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.02);
      border-radius:16px;
      padding:12px;
      display:none;
    }
    .feedback.show{ display:block; }

    .fbRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .badge{
      font-family:var(--mono);
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--muted);
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .badge.good{ border-color: rgba(74,222,128,.55); color:#c7f9d7; background: rgba(74,222,128,.10); }
    .badge.bad{ border-color: rgba(251,113,133,.55); color:#ffd0d8; background: rgba(251,113,133,.10); }
    .badge.warn{ border-color: rgba(251,191,36,.55); color:#ffe9b6; background: rgba(251,191,36,.10); }

    .explain{
      color:var(--muted);
      margin-top:10px;
      font-size:13px;
      line-height:1.55;
    }

    .controls{
      display:flex;
      gap:10px;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .mini{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--text);
      cursor:pointer;
      font-weight:900;
      transition: background .15s ease, transform .06s ease;
    }
    .mini:hover{ background: rgba(255,255,255,.06); transform: translateY(-1px); }
    .mini:active{ transform: translateY(0px); }
    .mini.primary{
      border-color: rgba(124,58,237,.6);
      background: rgba(124,58,237,.16);
    }
    .mini.good{
      border-color: rgba(34,197,94,.6);
      background: rgba(34,197,94,.12);
    }

    .footerNote{
      margin-top:12px;
      color:var(--muted);
      font-size:12px;
      line-height:1.45;
    }

    .toast{
      position:fixed;
      left:50%;
      bottom:20px;
      transform:translateX(-50%);
      background: rgba(20,20,27,.92);
      border:1px solid var(--line);
      box-shadow: var(--shadow);
      padding:10px 12px;
      border-radius:999px;
      color:var(--text);
      font-size:13px;
      display:none;
      gap:10px;
      align-items:center;
      z-index:50;
      max-width:min(92vw, 520px);
    }
    .toast.show{ display:flex; }
    .toast .b{
      width:10px;height:10px;border-radius:999px;
      background: var(--accent2);
      box-shadow:0 0 0 3px rgba(34,197,94,.18);
      flex:0 0 auto;
    }

    /* Result screen */
    .result{
      display:none;
      text-align:center;
      padding:10px 4px 0;
    }
    .result h2{
      margin:8px 0 6px;
      font-size:22px;
      font-weight:1000;
      letter-spacing:.2px;
    }
    .result p{
      margin:6px 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.55;
    }
    .bigNum{
      font-size:52px;
      font-weight:1000;
      margin:10px 0 0;
    }
    .smallRow{
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }

    /* Mobile tweaks */
    @media (max-width: 600px){
      body{
        padding:12px;
        padding-top: calc(20px + env(safe-area-inset-top));
      }
      .question{ font-size:18px; }
      .btn{ padding:12px; }
      .key{ width:26px; height:26px; border-radius:9px; }
      .choiceText{ font-size:13px; }
      .pill,.chip{ font-size:11px; padding:5px 8px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <section class="card">
      <div class="head">
        <div class="title">
          <span class="dot"></span>
          <span class="txt">STS Trivia</span>
        </div>
        <div class="pill" id="scorePill">Score: 0</div>
      </div>

      <div class="main">
        <div class="qmeta">
          <div class="chip">Q <strong id="qNum">0</strong>/<span id="qTotal">0</span></div>
          <div class="chip">Diff: <strong id="qDiff">â€”</strong></div>
          <div class="chip">Streak: <strong id="streak">0</strong></div>
          <div class="progress"><div class="bar" id="bar"></div></div>
        </div>

        <div class="timerWrap" id="timerWrap"><div class="timerBar" id="timerBar"></div></div>
        <div class="timerHint" id="timerHint"><span>15s</span><span>think fast ðŸ’€</span></div>

        <div class="question" id="questionText">Press Start.</div>
        <p class="sub" id="questionSub">15 seconds each question. One correct answer only.</p>

        <div class="choices" id="choices"></div>

        <div class="feedback" id="feedback">
          <div class="fbRow">
            <span class="badge" id="resultBadge">â€”</span>
            <span class="badge" id="answerBadge">â€”</span>
          </div>
          <div class="explain" id="explain"></div>
        </div>

        <div class="controls" id="startControls">
          <button class="mini primary" id="startBtn">Start</button>
        </div>

        <!-- Result screen -->
        <div class="result" id="resultScreen">
          <h2>Finished ðŸ‘‘</h2>
          <div class="bigNum" id="finalScoreBig">0</div>
          <p id="finalLine">â€”</p>

          <div class="smallRow">
            <button class="mini good" id="exportBtn">Export Result Card</button>
            <button class="mini primary" id="playAgainBtn">Play Again</button>
          </div>

          <p style="margin-top:12px;">
            Tip: if you want a harder run, shuffle the questions in your repo later ðŸ˜ˆ
          </p>
        </div>

        <div class="footerNote">
          Keyboard (PC): <span style="font-family:var(--mono)">A B C D</span> Â· Auto-next after answer/timeout.
        </div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast"><span class="b"></span><span id="toastTxt">Nice.</span></div>

<script>
(() => {
  // ===== Question bank (1 correct each) =====
  const QUESTIONS = [
    { q:"What does STS stand for?",
      choices:["Science, Technology, and Society","Social Technology Systems","Science and Technical Systems","Systems, Tools, and Software"],
      a:0, diff:"Easy", topic:"STS",
      explain:"STS studies how science & technology affect society and how society shapes them."
    },
    { q:"Science is mainly theâ€¦",
      choices:["application of knowledge to build tools","systematic study of the natural world through observation and experimentation","set of laws made by government","art of creating machines only"],
      a:1, diff:"Easy", topic:"Science",
      explain:"Science uses observation + experiments to understand the natural world."
    },
    { q:"Technology is best described asâ€¦",
      choices:["only computers and phones","a political system","application of scientific knowledge to create tools/processes that improve life","the same as science"],
      a:2, diff:"Easy", topic:"Technology",
      explain:"Technology applies knowledge to make tools/systems that solve problems."
    },
    { q:"In STS, science and technology are consideredâ€¦",
      choices:["unrelated","interdependent","enemies of society","only school subjects"],
      a:1, diff:"Easy", topic:"STS",
      explain:"Discoveries create new tech, and tech helps create new discoveries."
    },
    { q:"Which enabled record-keeping and knowledge transfer in early civilizations?",
      choices:["Wheel","Cuneiform and Hieroglyphics","DNA model","Smartphone"],
      a:1, diff:"Easy", topic:"History",
      explain:"Writing systems let people store and share information across generations."
    },
    { q:"Roman Aqueducts were engineered mainly toâ€¦",
      choices:["carry water to cities","create electricity","build phones","edit genes"],
      a:0, diff:"Easy", topic:"History",
      explain:"Aqueducts delivered water for public use like baths and fountains."
    },
    { q:"Gutenbergâ€™s Printing Press (c. 1440) enabledâ€¦",
      choices:["mass production of written materials","instant messaging","genetic editing","flight"],
      a:0, diff:"Easy", topic:"History",
      explain:"Mass printing spread knowledge faster and made books more accessible."
    },
    { q:"Francis Bacon is linked to promoting theâ€¦",
      choices:["scientific method","steam engine","roman aqueduct","blockchain"],
      a:0, diff:"Medium", topic:"Scientific Revolution",
      explain:"He emphasized systematic observation and experimentation."
    },
    { q:"James Wattâ€™s steam engine mainly boostedâ€¦",
      choices:["mechanized production and productivity","ancient trade only","DNA research","writing systems"],
      a:0, diff:"Medium", topic:"Industrial Revolution",
      explain:"Steam power drove machines and factories, increasing productivity."
    },
    { q:"Flemingâ€™s penicillin (1928) was the firstâ€¦",
      choices:["effective antibiotic","printing press","smartphone OS","gene editor"],
      a:0, diff:"Easy", topic:"20th Century",
      explain:"Penicillin treated bacterial infections and transformed medicine."
    },
    { q:"CRISPR-Cas9 (2012) enablesâ€¦",
      choices:["precise gene editing","roman water delivery","mass book printing","mechanical timekeeping"],
      a:0, diff:"Medium", topic:"21st Century",
      explain:"CRISPR allows targeted editing of DNA for medicine and agriculture."
    },
    { q:"Banaue Rice Terraces are best described asâ€¦",
      choices:["an engineering marvel for sustainable farming/irrigation","a modern phone invention","a roman aqueduct","a gene tool"],
      a:0, diff:"Easy", topic:"Philippines",
      explain:"They show advanced indigenous engineering adapted to mountain farming."
    },
    { q:"Respect for people in research includesâ€¦",
      choices:["obtaining informed consent and protecting privacy","sharing private info publicly","testing without permission","taking data without consent"],
      a:0, diff:"Easy", topic:"Ethics",
      explain:"Ethical research requires consent and protects participantsâ€™ privacy."
    },
    { q:"Accountability and fair access meansâ€¦",
      choices:["taking responsibility for consequences and ensuring equitable access","only rich people get tech","never admitting mistakes","hiding risks"],
      a:0, diff:"Hard", topic:"Ethics",
      explain:"Innovators should own outcomes and reduce inequality in access to tech."
    },
  ];

  // ===== Settings =====
  const TIME_MS = 15000;     // 15 seconds
  const AUTO_NEXT_MS = 1200; // delay before next question

  // ===== State =====
  let pool = [];
  let idx = 0;
  let locked = false;

  let score = 0;
  let correct = 0;
  let wrong = 0;
  let streak = 0;
  let answered = 0;

  // Timer animation
  let raf = null;
  let tEnd = 0;

  // ===== DOM =====
  const qNumEl = document.getElementById("qNum");
  const qTotalEl = document.getElementById("qTotal");
  const qDiffEl = document.getElementById("qDiff");
  const streakEl = document.getElementById("streak");
  const barEl = document.getElementById("bar");
  const scorePill = document.getElementById("scorePill");

  const timerWrap = document.getElementById("timerWrap");
  const timerBar = document.getElementById("timerBar");
  const timerHint = document.getElementById("timerHint");

  const questionTextEl = document.getElementById("questionText");
  const questionSubEl = document.getElementById("questionSub");
  const choicesEl = document.getElementById("choices");

  const feedbackEl = document.getElementById("feedback");
  const resultBadgeEl = document.getElementById("resultBadge");
  const answerBadgeEl = document.getElementById("answerBadge");
  const explainEl = document.getElementById("explain");

  const startControlsEl = document.getElementById("startControls");
  const startBtn = document.getElementById("startBtn");

  const resultScreen = document.getElementById("resultScreen");
  const finalScoreBig = document.getElementById("finalScoreBig");
  const finalLine = document.getElementById("finalLine");
  const exportBtn = document.getElementById("exportBtn");
  const playAgainBtn = document.getElementById("playAgainBtn");

  const toast = document.getElementById("toast");
  const toastTxt = document.getElementById("toastTxt");

  // ===== Helpers =====
  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }
  function pct(n,d){ return d===0 ? 0 : Math.round((n/d)*100); }

  function setToast(msg, good=true){
    toastTxt.textContent = msg;
    const b = toast.querySelector(".b");
    b.style.background = good ? "var(--accent2)" : "var(--bad)";
    b.style.boxShadow = good ? "0 0 0 3px rgba(34,197,94,.18)" : "0 0 0 3px rgba(251,113,133,.18)";
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"), 900);
  }

  // ===== Sounds (no external files) =====
  let audioCtx = null;
  function ensureAudio(){
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if(audioCtx.state === "suspended") audioCtx.resume();
    return audioCtx;
  }
  function beep(type="ok"){
    const ctx = ensureAudio();
    const now = ctx.currentTime;
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = "sine";

    let f1=660, f2=880, dur=0.12;
    if(type==="bad"){ f1=220; f2=165; dur=0.14; }
    if(type==="time"){ f1=330; f2=220; dur=0.16; }

    o.frequency.setValueAtTime(f1, now);
    o.frequency.exponentialRampToValueAtTime(Math.max(50,f2), now + dur);

    g.gain.setValueAtTime(0.0001, now);
    g.gain.exponentialRampToValueAtTime(0.18, now + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, now + dur);

    o.connect(g); g.connect(ctx.destination);
    o.start(now);
    o.stop(now + dur + 0.02);
  }

  function stopTimer(){
    if(raf) cancelAnimationFrame(raf);
    raf = null;
  }

  function startTimer(){
    stopTimer();
    timerWrap.style.display = "block";
    timerHint.style.display = "flex";
    timerBar.style.transform = "scaleX(1)";
    timerWrap.style.borderColor = "rgba(251,191,36,.45)";

    const tStart = performance.now();
    tEnd = tStart + TIME_MS;

    const tick = (now) => {
      if(locked) return;
      const remaining = Math.max(0, tEnd - now);
      const p = remaining / TIME_MS; // 1 -> 0
      timerBar.style.transform = `scaleX(${p})`;

      if(remaining <= 3500){
        timerWrap.style.borderColor = "rgba(251,113,133,.55)";
      }

      if(remaining <= 0){
        stopTimer();
        timeUp();
        return;
      }
      raf = requestAnimationFrame(tick);
    };
    raf = requestAnimationFrame(tick);
  }

  function timeUp(){
    if(locked) return;
    beep("time");
    choose(-1, true);
  }

  function updateTopBar(){
    scorePill.textContent = `Score: ${score}`;
    streakEl.textContent = streak;
  }

  function loadQuestion(){
    if(idx >= pool.length){
      showEnd();
      return;
    }

    const q = pool[idx];
    locked = false;

    qNumEl.textContent = (idx + 1);
    qTotalEl.textContent = pool.length;
    qDiffEl.textContent = q.diff;

    const progress = idx / pool.length;
    barEl.style.width = `${Math.max(6, Math.round(progress * 100))}%`;

    questionTextEl.textContent = q.q;
    questionSubEl.textContent = `Topic: ${q.topic} Â· One correct answer.`;

    choicesEl.innerHTML = "";
    feedbackEl.classList.remove("show");

    const letters = ["A","B","C","D"];
    q.choices.forEach((txt, i) => {
      const b = document.createElement("button");
      b.className = "btn";
      b.innerHTML = `<span class="key">${letters[i]}</span><div class="choiceText">${txt}</div>`;
      b.addEventListener("click", () => choose(i, false));
      choicesEl.appendChild(b);
    });

    startTimer();
  }

  function choose(i, timedOut=false){
    if(locked) return;
    locked = true;
    stopTimer();

    const q = pool[idx];
    const correctIndex = q.a;
    const isCorrect = (!timedOut && i === correctIndex);

    const buttons = [...choicesEl.querySelectorAll(".btn")];
    buttons.forEach(b => b.disabled = true);

    // always highlight correct
    buttons[correctIndex]?.classList.add("good");
    if(!isCorrect && !timedOut && i >= 0) buttons[i]?.classList.add("bad");

    answered++;

    if(isCorrect){
      correct++;
      streak++;
      const bonus = Math.min(5, streak);
      const diffBoost = q.diff === "Hard" ? 3 : q.diff === "Medium" ? 2 : 1;
      score += (10 * diffBoost) + bonus;

      beep("ok");
      setToast(`Correct! +${(10*diffBoost)+bonus}`, true);

      resultBadgeEl.className = "badge good";
      resultBadgeEl.textContent = "âœ… Correct";
      explainEl.textContent = "Nice. Keep going.";
    } else {
      wrong++;
      streak = 0;
      score = Math.max(0, score - 3);

      beep(timedOut ? "time" : "bad");
      setToast(timedOut ? "Time's up ðŸ˜­ -3" : "Wrong ðŸ˜­ -3", false);

      resultBadgeEl.className = "badge " + (timedOut ? "warn" : "bad");
      resultBadgeEl.textContent = timedOut ? "â± Time's up" : "âŒ Wrong";

      // show brief explanation ALWAYS when wrong
      explainEl.textContent = q.explain || "Brief: The correct idea is the highlighted answer.";
    }

    answerBadgeEl.className = "badge";
    answerBadgeEl.textContent = `Answer: ${["A","B","C","D"][correctIndex]}`;

    feedbackEl.classList.add("show");
    updateTopBar();

    // auto-next
    setTimeout(() => {
      idx++;
      if(idx < pool.length){
        loadQuestion();
      } else {
        showEnd();
      }
    }, AUTO_NEXT_MS);
  }

  function showEnd(){
    stopTimer();
    locked = true;

    timerWrap.style.display = "none";
    timerHint.style.display = "none";
    feedbackEl.classList.remove("show");

    choicesEl.innerHTML = "";
    questionTextEl.textContent = "Quiz Finished ðŸ‘‘";
    questionSubEl.textContent = "";

    barEl.style.width = "100%";

    const accuracy = pct(correct, answered);
    finalScoreBig.textContent = score;
    finalLine.textContent = `Accuracy: ${accuracy}% â€¢ Correct: ${correct} â€¢ Wrong: ${wrong}`;

    resultScreen.style.display = "block";
  }

  // ===== Export Results Card (PNG) =====
  function exportResultCard(){
    const W = 1080, H = 1350;
    const canvas = document.createElement("canvas");
    canvas.width = W; canvas.height = H;
    const ctx = canvas.getContext("2d");

    const grad = ctx.createLinearGradient(0,0,W,H);
    grad.addColorStop(0, "#0b0b0f");
    grad.addColorStop(0.45, "#14141b");
    grad.addColorStop(1, "#0b0b0f");
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,W,H);

    function blob(x,y,r, color){
      const g = ctx.createRadialGradient(x,y,0, x,y,r);
      g.addColorStop(0, color);
      g.addColorStop(1, "rgba(0,0,0,0)");
      ctx.fillStyle = g;
      ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
    }
    blob(220, 200, 420, "rgba(124,58,237,.28)");
    blob(900, 160, 360, "rgba(34,197,94,.20)");
    blob(650, 1200, 520, "rgba(251,191,36,.12)");

    const pad = 70;
    const x = pad, y = pad, w = W - pad*2, h = H - pad*2;

    roundRect(ctx, x, y, w, h, 42);
    ctx.fillStyle = "rgba(255,255,255,.04)";
    ctx.fill();
    ctx.lineWidth = 3;
    ctx.strokeStyle = "rgba(255,255,255,.10)";
    ctx.stroke();

    ctx.fillStyle = "#f5f5ff";
    ctx.font = "900 54px system-ui, -apple-system, Segoe UI, Roboto, Arial";
    ctx.fillText("STS Trivia Results", x + 56, y + 105);

    ctx.fillStyle = "rgba(185,185,214,.95)";
    ctx.font = "700 28px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace";
    ctx.fillText(`Timer: 15s  â€¢  ${new Date().toLocaleString()}`, x + 56, y + 155);

    ctx.fillStyle = "#ffffff";
    ctx.font = "900 140px system-ui, -apple-system, Segoe UI, Roboto, Arial";
    ctx.fillText(`${score}`, x + 56, y + 320);

    ctx.fillStyle = "rgba(185,185,214,.95)";
    ctx.font = "900 30px system-ui, -apple-system, Segoe UI, Roboto, Arial";
    ctx.fillText("SCORE", x + 60, y + 360);

    const acc = Math.round((correct / Math.max(1, answered)) * 100);

    const boxY = y + 430;
    const gap = 22;
    const boxW = (w - 56*2 - gap) / 2;
    const boxH = 150;

    statBox(x + 56, boxY, boxW, boxH, "Accuracy", `${acc}%`, "rgba(34,197,94,.18)");
    statBox(x + 56 + boxW + gap, boxY, boxW, boxH, "Answered", `${answered}`, "rgba(124,58,237,.18)");
    statBox(x + 56, boxY + boxH + gap, boxW, boxH, "Correct", `${correct}`, "rgba(74,222,128,.18)");
    statBox(x + 56 + boxW + gap, boxY + boxH + gap, boxW, boxH, "Wrong", `${wrong}`, "rgba(251,113,133,.18)");

    ctx.fillStyle = "rgba(185,185,214,.70)";
    ctx.font = "600 22px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace";
    ctx.fillText("Made from STS slides â€¢ Trivia results card", x + 56, y + h - 60);

    const a = document.createElement("a");
    a.download = `sts_trivia_results_${Date.now()}.png`;
    a.href = canvas.toDataURL("image/png");
    a.click();

    setToast("Exported âœ…", true);

    function roundRect(c, x, y, w, h, r){
      c.beginPath();
      c.moveTo(x+r, y);
      c.arcTo(x+w, y, x+w, y+h, r);
      c.arcTo(x+w, y+h, x, y+h, r);
      c.arcTo(x, y+h, x, y, r);
      c.arcTo(x, y, x+w, y, r);
      c.closePath();
    }
    function statBox(x,y,w,h,label,value, glow){
      roundRect(ctx, x, y, w, h, 28);
      ctx.fillStyle = "rgba(255,255,255,.03)";
      ctx.fill();
      ctx.lineWidth = 2;
      ctx.strokeStyle = "rgba(255,255,255,.10)";
      ctx.stroke();

      const g = ctx.createRadialGradient(x+w*0.25, y+h*0.35, 0, x+w*0.25, y+h*0.35, Math.max(w,h));
      g.addColorStop(0, glow);
      g.addColorStop(1, "rgba(0,0,0,0)");
      ctx.fillStyle = g;
      ctx.fillRect(x, y, w, h);

      ctx.fillStyle = "rgba(185,185,214,.95)";
      ctx.font = "900 26px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText(label, x+26, y+48);

      ctx.fillStyle = "#ffffff";
      ctx.font = "1000 64px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText(value, x+26, y+115);
    }
  }

  function playAgain(){
    // reload is simplest + clean
    location.reload();
  }

  // Keyboard answers (PC)
  window.addEventListener("keydown", (e) => {
    const k = e.key.toUpperCase();
    const map = {A:0,B:1,C:2,D:3};
    if(map[k] !== undefined){
      const btns = choicesEl.querySelectorAll(".btn");
      if(btns[map[k]]) btns[map[k]].click();
    }
  });

  // Start button
  startBtn.addEventListener("click", () => {
    ensureAudio(); // unlock audio on iOS
    startControlsEl.style.display = "none";
    resultScreen.style.display = "none";
    pool = shuffle(QUESTIONS.slice());
    idx = 0;

    score = 0; correct = 0; wrong = 0; streak = 0; answered = 0;
    updateTopBar();

    setToast("Go.", true);
    loadQuestion();
  });

  exportBtn.addEventListener("click", exportResultCard);
  playAgainBtn.addEventListener("click", playAgain);

  // init
  qTotalEl.textContent = QUESTIONS.length;
  updateTopBar();
})();
</script>
</body>
</html>
